{"version":3,"sources":["webpack:///./src/views/category/Category.vue?1672","webpack:///./src/views/category/Category.vue","webpack:///./src/network/category.js","webpack:///./src/views/category/Category.vue?9df4"],"names":["class","id","left","default","active","tabClick","title","activeKey","activeName","accordion","categories","item","key","name","children","sub","getGoods","showGoods","itemClick","num","comments_count","tag","price","desc","updated_at","thumb","cover_url","origin-price","lazy-load","isback","btop","getCategory","request","url","getCategoryGoods","order","cid","page","setup","ruoter","currentOrder","currentCid","bs","goods","sales","list","value","init","then","res","data","document","querySelector","probeType","click","pullUpLoad","on","position","y","push","finishPullUp","refresh","scrollTo","index","orders","path","query","components","Navbar","Backtop","render","__scopeId"],"mappings":"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","file":"js/chunk-2d93c580.9118f187.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Category.vue?vue&type=style&index=0&id=6a8c40d6&scoped=true&lang=scss\"","<template>\r\n  <div>\r\n    <Navbar>\r\n      <template v-slot:left>\r\n        <div class=\"icon\"><i class=\"iconfont icon-jiantou\"></i></div>\r\n      </template>\r\n      <template v-slot:default> 商品分类 </template>\r\n    </Navbar>\r\n    <div id=\"mainbox\">\r\n      <div class=\"ordertab\">\r\n        <van-tabs v-model=\"active\" @click=\"tabClick\">\r\n          <van-tab title=\"月票\"></van-tab>\r\n          <van-tab title=\"推荐\"></van-tab>\r\n          <van-tab title=\"收藏\"></van-tab>\r\n        </van-tabs>\r\n      </div>\r\n      <van-sidebar class=\"leftmenu\" v-model=\"activeKey\">\r\n        <van-collapse v-model=\"activeName\" accordion>\r\n          <van-collapse-item\r\n            v-for=\"item in categories\"\r\n            :key=\"item.id\"\r\n            :title=\"item.name\"\r\n            :name=\"item.name\"\r\n          >\r\n            <van-sidebar-item\r\n              v-for=\"sub in item.children\"\r\n              :key=\"sub.id\"\r\n              :title=\"sub.name\"\r\n              @click=\"getGoods(sub.id)\"\r\n            />\r\n          </van-collapse-item>\r\n        </van-collapse>\r\n      </van-sidebar>\r\n      <div class=\"goodslist\">\r\n        <div class=\"content\">\r\n          <van-card\r\n            v-for=\"item in showGoods\"\r\n            :key=\"item.id\"\r\n            @click=\"itemClick(item.id)\"\r\n            :num=\"item.comments_count\"\r\n            :tag=\"item.comments_count > 0 ? '流行' : '标签'\"\r\n            :price=\"item.price\"\r\n            :desc=\"item.updated_at\"\r\n            :title=\"item.title\"\r\n            :thumb=\"item.cover_url\"\r\n            :origin-price=\"item.price + 10.0\"\r\n            :lazy-load=\"true\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <Backtop @btop=\"btop\" v-if=\"isback\"></Backtop>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Navbar from \"components/common/navbar/Navbar\";\r\nimport {useRouter} from \"vue-router\";\r\nimport { ref, reactive, onMounted, computed, watchEffect, nextTick } from \"vue\";\r\nimport { getCategory, getCategoryGoods } from \"network/category\";\r\nimport Backtop from \"components/common/backtop/Backtop\";\r\nimport BScroll from \"better-scroll\";\r\n\r\nexport default {\r\n  name: \"Category\",\r\n  setup() {\r\n    const ruoter = useRouter();\r\n\r\n    let active = ref(1);\r\n    let activeKey = ref(0);\r\n    let activeName = ref(1);\r\n    let categories = ref([]);\r\n    let isback = ref(false);\r\n\r\n    let currentOrder = ref(\"sales\");\r\n    let currentCid = ref(\"0\");\r\n    let bs = reactive({});\r\n\r\n    const goods = reactive({\r\n      sales: { page: 1, list: [] },\r\n      price: { page: 1, list: [] },\r\n      comments_count: { page: 1, list: [] },\r\n    });\r\n\r\n    const showGoods = computed(() => {\r\n      return goods[currentOrder.value].list;\r\n    });\r\n\r\n    const init = () => {\r\n      getCategoryGoods(\"sales\", currentCid.value).then((res) => {\r\n        goods.sales.list = res.goods.data;\r\n      });\r\n      getCategoryGoods(\"price\", currentCid.value).then((res) => {\r\n        goods.price.list = res.goods.data;\r\n      });\r\n      getCategoryGoods(\"comments_count\", currentCid.value).then((res) => {\r\n        goods.comments_count.list = res.goods.data;\r\n      });\r\n    };\r\n\r\n    onMounted(() => {\r\n      getCategory().then((res) => {\r\n        categories.value = res.categories;\r\n        // console.log(categories);\r\n      });\r\n      init();\r\n\r\n      bs = new BScroll(document.querySelector(\".goodslist\"), {\r\n        probeType: 3,\r\n        click: true,\r\n        pullUpLoad: true,\r\n      });\r\n\r\n      bs.on(\"scroll\", (position) => {\r\n        isback.value = -position.y > 300;\r\n  \r\n      });\r\n\r\n      bs.on(\"pullingUp\", () => {\r\n        const page = goods[currentOrder.value].page + 1;\r\n        getCategoryGoods(currentOrder.value, currentCid.value).then((res) => {\r\n          goods[currentOrder.value].list.push(...res.goods.data);\r\n          goods[currentOrder.value].page += 1;\r\n        });\r\n        // 完成上拉，等数据请求完成，将新数据展示出来\r\n        bs.finishPullUp();\r\n        // 重新计算高度\r\n        nextTick(() => {\r\n          // 监听计算高度\r\n          bs && bs.refresh();\r\n        });\r\n      });\r\n    });\r\n\r\n    const btop = () => {\r\n      bs.scrollTo(0, 0, 500);\r\n    };\r\n\r\n    // 排序选项卡\r\n    const tabClick = (index) => {\r\n      let orders = [\"sales\", \"price\", \"comments_count\"];\r\n      currentOrder.value = orders[index];\r\n      getCategoryGoods(currentOrder.value, currentCid.value).then((res) => {\r\n        goods[currentOrder.value].list = res.goods.data;\r\n        nextTick(() => {\r\n          // 监听计算高度\r\n          bs && bs.refresh();\r\n        });\r\n      });\r\n    };\r\n\r\n    // 监听任何一个变量\r\n    watchEffect(() => {\r\n      nextTick(() => {\r\n        // 监听计算高度\r\n        bs && bs.refresh();\r\n      });\r\n    });\r\n\r\n    const getGoods = (cid) => {\r\n      currentCid.value = cid;\r\n      init();\r\n    };\r\n\r\n    return {\r\n      activeKey,\r\n      categories,\r\n      activeName,\r\n      active,\r\n      tabClick,\r\n      currentOrder,\r\n      getGoods,\r\n      currentCid,\r\n      showGoods,\r\n      isback,\r\n      btop,\r\n      itemClick:(id) => {\r\n        ruoter.push({path:'/detail',query:{id}});\r\n      },\r\n    };\r\n  },\r\n  components: {\r\n    Navbar,\r\n    Backtop,\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n#mainbox {\r\n  margin-top: 45px;\r\n  display: flex;\r\n  .ordertab {\r\n    flex: 1;\r\n    height: 50px;\r\n    float: right;\r\n    z-index: 9;\r\n    position: fixed;\r\n    top: 45px;\r\n    right: 0;\r\n    left: 130px;\r\n  }\r\n  .leftmenu {\r\n    position: fixed;\r\n    top: 95px;\r\n    left: 0;\r\n    width: 130px;\r\n    height: 100vh;\r\n  }\r\n  .goodslist {\r\n    flex: 1;\r\n    position: absolute;\r\n    top: 100px;\r\n    left: 130px;\r\n    right: 0;\r\n    height: 100vh;\r\n    padding: 10px;\r\n    text-align: left !important;\r\n  }\r\n}\r\n.van-card_thumb {\r\n  width: 68px;\r\n}\r\n</style>","import {request} from './request';\r\n\r\nexport function getCategory() {\r\n  return request({\r\n    url: '/api/goods',\r\n    // method: 'get',\r\n    // params: {\r\n    // }\r\n  })\r\n}\r\n\r\nexport function getCategoryGoods(order='sales', cid=0, page=1) {\r\n  return request({\r\n    url: '/api/goods?category_id='+cid+'&page='+page+'&'+order+'=1',\r\n  })\r\n}","import { render } from \"./Category.vue?vue&type=template&id=6a8c40d6&scoped=true\"\nimport script from \"./Category.vue?vue&type=script&lang=js\"\nexport * from \"./Category.vue?vue&type=script&lang=js\"\n\nimport \"./Category.vue?vue&type=style&index=0&id=6a8c40d6&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-6a8c40d6\"\n\nexport default script"],"sourceRoot":""}